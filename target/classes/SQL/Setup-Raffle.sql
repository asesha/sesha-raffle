CREATE DATABASE RAFFLE;
USE RAFFLE;

CREATE TABLE AUCTION (
    AUCTION_ID     INT  NOT NULL AUTO_INCREMENT, 
    AUCTION_NAME   VARCHAR(40)  NOT NULL,
    PRIZE_COUNT INT NOT NULL,
    CREATED_ON  DATE NOT NULL,
    CREATED_BY VARCHAR(40),
    UPDATED_ON DATE NOT NULL,
    UPDATED_BY VARCHAR(40),
	START_DATE  DATE NOT NULL,
	START_TIME  TIME NOT NULL,
    END_DATE  DATE NOT NULL,
	END_TIME  TIME NOT NULL,
    DRAWING_DATE  DATE NOT NULL,
	DRAWING_TIME  TIME NOT NULL,
    MIN_TICKETS INT NOT NULL,
    MAX_TICKETS INT NOT NULL,
    PRIMARY KEY (AUCTION_ID),                
    UNIQUE  KEY (AUCTION_NAME)               
);

CREATE TABLE PRODUCT (
	 PRODUCT_ID    INT  NOT NULL AUTO_INCREMENT, 
     PRODUCT_NAME   VARCHAR(40)  NOT NULL,
     PRODUCT_CATEGORY   VARCHAR(100)  NOT NULL,
     PRODUCT_IMAGE VARCHAR(100)  NOT NULL,
     PRODUCT_VIDEO VARCHAR(100)  NOT NULL,
     PRODUCT_DESC VARCHAR(100)  NOT NULL,
	 CREATED_ON  DATE NOT NULL,
     CREATED_BY VARCHAR(40),
     UPDATED_ON DATE NOT NULL,
     UPDATED_BY VARCHAR(40),
     PRIMARY KEY (PRODUCT_ID),                
     UNIQUE  KEY (PRODUCT_NAME)               
);


CREATE TABLE USERS (
	 USER_ID    INT  NOT NULL AUTO_INCREMENT, 
     USER_NAME   VARCHAR(40)  NOT NULL,
     WALLET_ID    INT,
     EMAIL   VARCHAR(40)  NOT NULL,
     PHONE VARCHAR(40)  NOT NULL,
     ADDRESS VARCHAR(100)  NOT NULL,
	 CREATED_ON  DATE NOT NULL,
     CREATED_BY VARCHAR(40) NOT NULL,
     UPDATED_ON DATE,
     UPDATED_BY VARCHAR(40),
     PRIMARY KEY (USER_ID),                
     UNIQUE  KEY (USER_NAME)               
);


CREATE TABLE USER_AUCTION (
	 USER_ACTION_ID INT  NOT NULL AUTO_INCREMENT, 
     USER_ID_FK    INT  NOT NULL, 
     AUCTION_ID_FK   INT NOT NULL,
     CREATED_ON  DATE NOT NULL,
     STATUS CHAR(1),
     PRIMARY KEY (USER_ACTION_ID)                
);

ALTER TABLE USER_AUCTION ADD FOREIGN KEY (USER_ID_FK) REFERENCES USERS(USER_ID);
ALTER TABLE USER_AUCTION ADD FOREIGN KEY (AUCTION_ID_FK) REFERENCES AUCTION(AUCTION_ID);


CREATE TABLE AUCTION_TICKETS (
	AUCTION_TICKETS_ID  INT  NOT NULL AUTO_INCREMENT, 
    AUCTION_ID_FK  INT  NOT NULL, 
    TICKET_ID   INT  NOT NULL,
    USER_ID_FK INT NOT NULL,
    CREATED_ON  DATE NOT NULL,
    UNIQUE (AUCTION_ID_FK,TICKET_ID),
    PRIMARY KEY (AUCTION_TICKETS_ID)
);

ALTER TABLE AUCTION_TICKETS ADD FOREIGN KEY (AUCTION_ID_FK) REFERENCES AUCTION(AUCTION_ID);
ALTER TABLE AUCTION_TICKETS ADD FOREIGN KEY (USER_ID_FK) REFERENCES USERS(USER_ID);


CREATE TABLE AUCTION_PRIZE_DETAILS(
	AUCTION_PRIZE_ID  INT  NOT NULL AUTO_INCREMENT,
    AUCTION_ID_FK INT NOT NULL,
    PRIZE_POSITION INT NOT NULL,
    PRIZE_INDEX INT NOT NULL,
    PRODUCT_ID_FK  INT,
	WINNER_ID_FK  INT,
	TICKET_ID  INT,
    CREATED_ON  DATE NOT NULL,
    CREATED_BY VARCHAR(40),
    UPDATED_ON DATE,
    UPDATED_BY VARCHAR(40),
    PRIMARY KEY (AUCTION_PRIZE_ID),
    UNIQUE  KEY (AUCTION_ID_FK,PRIZE_POSITION,PRIZE_INDEX)
);


ALTER TABLE AUCTION_PRIZE_DETAILS ADD FOREIGN KEY (AUCTION_ID_FK) REFERENCES AUCTION(AUCTION_ID);  
ALTER TABLE AUCTION_PRIZE_DETAILS ADD FOREIGN KEY (PRODUCT_ID_FK) REFERENCES PRODUCT(PRODUCT_ID);
ALTER TABLE AUCTION_PRIZE_DETAILS ADD FOREIGN KEY (WINNER_ID_FK) REFERENCES USERS(USER_ID);

